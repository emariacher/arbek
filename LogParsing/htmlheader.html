<div dojotype="dojo.data.ItemFileReadStore" data="storeData" jsid="testStore"></div>
<div dojotype="dijit.tree.ForestStoreModel" jsid="testModel" store="testStore" query="{}" rootid="Tests" rootlabel="Tests"></div>
<div dojotype="dijit.Tree" id="mytree" model="testModel" openonclick="true">
<script type="dojo/method" event="onLoad" args="item">
var menuItem = null
console.log("onLoad")
//console.dir(dojo.query("div"))
menuItem = gup1( 'menuItem' );
var zeMsg = null
var itemFx = function(myItem, i){
    zeMsg = myItem.msg
};
items = testStore.fetch({query: {tidtoc: menuItem}, onItem: itemFx}); 
console.log("menuItem: "+menuItem)
zeMsg = menuItem
console.log("zeMsg: "+zeMsg)
var isIE = check(/msie/);
console.log("isIE: "+isIE)
if(!isIE) {
for (i=1;i<=60;i++) {
    dojo.query("div#dijit__TreeNode_"+i).forEach(function(node, index, arr){
	if(node) {
            console.log("div#dijit__TreeNode_"+i+" node.textContent ["+node.textContent.replace(/\W/g, '')+"]")
            /*console.log("       index: "+index)
            console.log("       arr: "+arr)
            console.log("       t: "+node.tagName)
            console.log("       n: "+node.nodeName)
            console.log("       l: "+node.localName)
            console.log("       p: "+node.prefix)
            console.log("       v: "+node.value)
            console.log("       a: "+node.attributes)
            console.log("zeMsg: "+zeMsg)
            console.log("       node--: "+node.textContent.replace(/\W/g, ''))
            console.log("       parent--: "+node.parentNode.textContent.replace(/\W/g, ''))
            var nma = node.attributes
            console.log("       nmalength: "+nma.length)
            for (j=0;j<nma.length;j++) {
            var itemnma = nma.item(j)
            console.log("         ["+j+"]: "+itemnma.nodeName+" "+itemnma.value)
            }*/
            if((endsWith(zeMsg,node.textContent.replace(/\W/g, '')))&&(node.textContent.indexOf("*")==0)) {
                console.log("div#dijit__TreeNode_"+i+" found!")
                node.style.backgroundColor="yellow"
                node.style.color="black"
                node.style.fontWeight="bold"
                node.style.fontSize=18
            } else if(node.textContent.indexOf("_Summary")>=0) {
                node.style.backgroundColor="#f8d0d0"
                node.style.color="black"
                node.style.fontWeight="bold"
            } else {
                node.style.backgroundColor="#f8d0d0"
                node.style.color="red"
                node.style.fontWeight="bold"
            }
			}
    });
}
}
if(menuItem.length>0) {
    console.log("1 menuItem: "+menuItem)
    divtest = document.getElementById(menuItem);
    console.log("1 divtest: "+divtest)
    divs=document.getElementsByTagName("DIV");
    if (divtest!=null) {
        for (i=0;i<divs.length;i++) {
            if(divs[i].id.length == 0) {
            } else if(divs[i].id.indexOf("dijit") == 0) {
            } else if(divs[i].id.indexOf("mytree") == 0) {
            } else {
                divs[i].style.display="none";
            }
        }
        divtest.style.display="block";
        menuItem="#"+menuItem
    } else {
        var s_all = menuItem.substr(0,menuItem.indexOf("_All"))
        console.log("s_all: "+s_all)
        for (i=0;i<divs.length;i++) {
            console.log("divs["+i+"]: "+divs[i].id)
            divs[i].style.display="block";
        }
        menuItem=""
    }
}

function endsWith(str, suffix) {
    return str.indexOf(suffix, str.length - suffix.length) !== -1;
}

function check(r) {
    return r.test(navigator.userAgent.toLowerCase());
};

function gup1( name ) {
    name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
    var regexS = "[\\?&]"+name+"=([^&#]*)";
    var regex = new RegExp( regexS );
    var results = regex.exec( window.location.href );
    if( results == null )
        return "";
    else
        return results[1];
}			    
</script>
<script type="dojo/method" event="onClick" args="item">
console.log("hello world")
menuItem = testStore.getIdentity(item);
title = document.title
console.log("0 "+window.location.href + " " +window.location.href.indexOf("?") + " " +window.location.href.indexOf("\?"))
if(window.location.href.indexOf("?")<0) {
    s_nextPage = window.location.href+"?menuItem="+menuItem;
} else {
    s_nextPage = window.location.href.substr(0,window.location.href.indexOf("?"))+"?menuItem="+menuItem;
}
console.log("a1 "+s_nextPage)
dojo.query('input#').forEach(function(node, index, arr){
        //console.log("a2 "+s_nextPage);
        s_nextPage = s_nextPage + gup3(node.id);
        //console.log("a3 "+s_nextPage);
});
console.log("a4 "+s_nextPage)
window.location.href = s_nextPage

function gup3( name ) {
    name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
    var regexS = "[\\?&]"+name+"=([^&#]*)";
    var regex = new RegExp( regexS );
    var results = regex.exec( window.location.href );
    if( results == null )
        return "";
    else
        return "&"+name+"="+results[1];
}			    	
</script>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.5/dojo/dojo.xd.js" djconfig="parseOnLoad: true"></script>
<script>
dojo.require("dojo.data.ItemFileReadStore");
dojo.require("dijit.Tree");

